<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Scripting example</title>
	
	<script type="text/javascript" src="javascript/includes/json_parse.js"></script>
	<script src="http://code.jquery.com/jquery-1.7.2.min.js" language="javascript" type="text/javascript"></script>
	
</head>

<body>
	<h3>Servlet script</h3>
	<table style="width:100%;">
	<tr>
		<td valign="top" rowspan=1>
			Available scripts:<br>
			<table>
				<tr><td>
					<select size=18 id="scriptList" onChange="loadScript(this.value)">
					</select>
				</td></tr>
			</table>
		</td>
		<td valign="top">
		  		<table>
		  			<tr><td>
		  				Put your js script here:<br>
		  				<div style="width:750px">
		  				<textarea id="script" name="script" rows=20 cols=90></textarea></div>
		  			</td></tr>
		  			<tr><td><center>
		    			<button onclick="runScript()">Run script</button>
		    		</center></td></tr>
		  		</table>
		</td>
		<td valign="top" rowspan=3 width="100%">
			<div id="hints" class="help">&nbsp;</div>
		</td>
	</tr>
	<tr>
		<td valign="top" rowspan=1>
		</td>
		<td valign="top">Output:<br><textarea name="result" id="result" rows=10 cols=90></textarea></td>
	</tr>
	<tr>
		<td>
			Available view:<br>
			<table>
				<tr><td>
					<select size=10 id="viewList" onChange="loadView(this.value)">
					</select>
				</td></tr>
			</table>
		
		</td>
		<td>
			View: <button onclick="openVisualizer();">Open visualizer</button>
			<br><textarea name="view" id="view" rows=10 cols=90></textarea>
		</td>
	</tr>


	</table>
	
		
<script type="text/javascript">
	var url='http://script.epfl.ch/servletScript/JavaScriptServlet';

	
	function runScript() {
		jQuery.post(url,
				{
					script: $('#script').val()
				},
				function(data) {
					$('#result').val(data);
			  });
		
	}
	
	
	
	
	function loadScript(scriptName) {
		jQuery.get(url,
			{
				action: "LoadScript",
				name:scriptName
			},
			function(data) {
				$('#script').val(data);
		  });
	}
	
	function loadView(scriptName) {
		jQuery.get(url,
			{
				action: "LoadScript",
				name:scriptName
			},
			function(data) {
				$('#view').val(data);
		  });
	}
	

	
	function refreshInfo() {
		jQuery.get(url,
			{
				action: "ListScript"
			},
			function(data) {
				var lines=data.split(/[\r\n]+/);
				$('scriptList').innerHTML="";
				$('viewList').innerHTML="";
				for (var i=0; i<lines.length; i++) {
					if (lines[i]!="") {
						var option = document.createElement('option');
						option.value=lines[i];
						if (lines[i].match(/.*\.js$/)) {
							option.appendChild(document.createTextNode(lines[i]));
							$('#scriptList').append(option);
						}
						if (lines[i].match(/.*\.view$/)) {
							option.appendChild(document.createTextNode(lines[i]));
							$('#viewList').append(option);
						}
					}
				}
		  });
	}
	

	refreshInfo();

</script>



<script language="javascript">
function getLayout() {
	return $('#view').val();
}


this.getData = function() {
	var value=JSON.parse($('#result').val());
	//return value.result;
	return value.result;
}

function openVisualizer() {
	var newWindow=window.open("../visualizer.html","visualizer");
	
}
</script>

</body>
</html>